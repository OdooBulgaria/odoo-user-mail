<?xml version="1.0"?>
<openerp>
    <data>
        <record id="user_mail_sync_view" model="ir.ui.view">
            <field name="name">user.mail.sync.form</field>
            <field name="model">user.mail.sync.wizard</field>
            <field name="arch" type="xml">
                <form string="Synchronize Settings">
<!--
                    <field name="user_ids"/>
-->
                    <label for="gen_pw" string="Generate Password"/>
                    <field name="gen_pw"/>
                    <footer>
                        <button type="object" name="sync_settings" string="Synchronize Settings" class="oe_highlight"/>
                        <button special="cancel" string="Cancel"/>
                    </footer>
                </form>
            </field>
        </record>


        <act_window id="action_user_mail_sync"
            multi="True"
            key2="client_action_multi" name="Synchronize Settings"
            res_model="user.mail.sync.wizard" src_model="res.users"
            view_mode="form" target="new"/>         
      <!--
      <record id="mail_config_view" model="ir.ui.view">
        <field name="name">mail.user.config</field>
              <field name="model">res.users</field>
              <field name="inherit_id" ref="base.view_users_form"/>
              <field name="arch" type="xml">



            </field>
      </record>
    -->

<!--
         <record id="view_res_partner" model="ir.ui.view">
            <field name="name">res.partner.inherit.form</field>
            <field name="model">res.partner</field> 
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="priority" eval="50"/>
            <field name="arch" type="xml">
                <field name="function" position="before"> 
                    <field name="ss_number"/>
                </field>
            </field>
        </record>
-->



<!--
        <record id="view_users_form" model="ir.ui.view">
            <field name="name">res.users.form.mail.inherit</field>
            <field name="model">res.users</field>
            <field name="inherit_id" ref="base.view_users_form"/>
            <field name="arch" type="xml">
                <page string="Preferences" position="after">
                    <page string="E-mail settings">
                        <field name="postfix_active" />                        
    
               
                        <group colspan="4" col="4">
                            <separator string="Vacation" colspan="4"/>
                                <field name="vacation_active" />
                                <group>
                                    <field name="vacation_subject" colspan="6" attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', False)]}" />
                                    <field name="vacation_from" colspan="1" attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', False)]}"  />
                                    <field name="vacation_to" colspan="1" attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', False)]}"  />
                                    <field name="vacation_text" nolabel="1" colspan ="6" attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', False)]}"  />
                                    <field name="vacation_forward" colspan="6" attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', False)]}" />
                                </group>
                            <separator string="Forward" colspan="4"/>
                                <field name="forward_active" />
                                <field name="forward_address" nolabel="1" attrs="{'invisible': [('forward_active', '=', False)], 'required':[('forward_active', '=', True)]}" />
                                <field name="forward_cp" attrs="{'invisible': [('forward_active', '=', False)], 'required':[('forward_active', '=', True)]}" />
                        </group>
                        
                        <group colspan="2" col="2">
                            <separator string="Virus check" colspan="2" />
                                <field name="virus_active" />
                            <separator string="Spam check" colspan="2" />
                                <field name="spam_active" />
                                <field name="spam_killevel" attrs="{'invisible': [('spam_active', '=', False)], 'required':[('spam_active', '=', True)]}" />
                                <field name="spam_tag" attrs="{'invisible': [('spam_active', '=', False)], 'required':[('spam_active', '=', True)]}" />
                                <field name="spam_tag2" attrs="{'invisible': [('spam_active', '=', False)], 'required':[('spam_active', '=', True)]}" />  
                        </group>
                        <group colspan="2" col="2">
                            <field name="maildir" />
                            <field name="transport" />
                            <field name="quota" />
                            <field name="domain" />
                        </group>
                        
                        <group colspan="2" col="2">
                            <separator string="Mail alias" colspan="2" />
                            <field colspan="2" name="alias_mail" nolabel="1" widget="one2many_list">
                                <tree editable="bottom" string="Mail alias">
                                  <field name="mail"/>
                                  <field name="active"/>  
                                </tree>  
                            </field>
                            <newline/>
                         </group>
                    </page>
                </page>
            </field>
        </record>
-->
<!-- Update user form !-->
        <record id="view_users_form_conf_mail_settings" model="ir.ui.view">
            <field name="name">res.users.form.mail.settings</field>
            <field name="model">res.users</field>
            <field name="inherit_id" ref="base.view_users_form_simple_modif"/>
            <field name="arch" type="xml">
                <data>
                    <group string="Email Preferences" position="replace">

                    </group>
                    <field name="company_id" position="after">
                      <notebook colspan="5">
                        <page string="Email Preferences">

                          <group string="E-mail Preferences">
                            <field name="email" widget="email" readonly="0"/>
                            <field name="signature" readonly="0"/>
                          </group>

                        </page>
                        <page string="E-mail settings" groups="user_mail.group_own_email_settings,user_mail.group_own_email_settings">
                            
                            <group colspan="4" col="4" string="E-mail Settings">
                                 <field name="postfix_active" col="2" colspan="4" readonly="0"/><newline/>
                               
                                <group attrs="{'invisible': [('postfix_active','=',False)],}" colspan="4" col="4">

                                    <separator string="Vacation" colspan="4" />
                                                <field name="vacation_active" readonly="0"/><newline/>
                                                <field name="vacation_from"  col="2"       attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}"  readonly="0"/>
                                                <field name="vacation_to"  col="2"         attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}"  readonly="0"/>
                                                <field name="vacation_subject" placeholder="I am at vacation" colspan="4" attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}" />
                                                <field name="vacation_text" nolabel="1" colspan="4" 
                                                                                           attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}" readonly="0" />
                                                <field name="vacation_forward" placeholder="my@vacationmail.com" col="2" colspan="4" 
                                                                                           attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}" readonly="0"/>


                                    <separator string="Forward" colspan="4" />                            
                                        <field name="forward_active" readonly="0"/><newline/>
                                            <field name="forward_address" nolabel="1" placeholder="my@temporarymail.comXanother@mailaddress.com" colspan="4" attrs="{'invisible': [('forward_active', '=', False)], 'required':[('forward_active', '=', True)]}" readonly="0"/>
                                            <field name="forward_cp"      col="2" colspan="4"     attrs="{'invisible': [('forward_active', '=', False)]}" readonly="0"/>
                                                                                            
                                     
                                    <separator string="Virus check" colspan="4"/>
                                        <field name="virus_active" colspan="4" readonly="0"/>
                                    <separator string="Spam check" colspan="4" />
                                        <field name="spam_active"   readonly="0"/><newline/>
                                        <field name="spam_tag"      colspan="4" attrs="{'invisible': [('spam_active', '=', False),], 'required':[('spam_active', '=', True)]}" readonly="0"/>
                                        <field name="spam_tag2"     colspan="4" attrs="{'invisible': [('spam_active', '=', False),], 'required':[('spam_active', '=', True)]}" readonly="0"/>
                                        <field name="spam_killevel" colspan="4" attrs="{'invisible': [('spam_active', '=', False),], 'required':[('spam_active', '=', True)]}" readonly="0"/>

                                    <separator string="Misc" colspan="4" />                        
                                        <field name="maildir"   readonly="0"/><newline/>
                                        <field name="transport" readonly="0"/><newline/>
                                        <field name="quota" readonly="0"/><newline/>
                                        <field name="domain" readonly="0"/><newline/>
                                           <field name="passwd_mail" /><newline/>

                                        <separator string="Alias" readonly="0"/><newline/>
<!--                                             <field name="mail_alias" nolabel="1" widget="one2many_list" colspan="4" >
                                                <tree editable="bottom" string="Mail alias">
                                                  <field name="mail"/>
                                                  <field name="active"/>  
                                                </tree>  
                                            </field> -->

                                </group>
                            </group> 
                        </page>
                    </notebook>
                </field>
                </data>
            </field>
        </record>









        <!-- Force update of groups' user view.
             When updating (not new install), as `share` module is not loaded yet, shared groups
             are taken into account when getting the group list, resulting to a different
             organisation of the `Sharing` category (booleans instead of a selection) and thus,
             different virtual field names.
             When applying then inheritance of the following view, the check of field names
             failed due to these virtual field name missmatch.
             This is only for databases updated between a6eac0f08ee9100d1a44a4068d4f580b1c7c4b2c
             and the commit introducing this line.
        -->
        <function model="res.groups" name="update_user_groups_view" />

        <!-- Update user form !-->
        <record id="view_users_form_conf_mail" model="ir.ui.view">
            <field name="name">res.users.form.mail</field>
            <field name="model">res.users</field>
            <field name="inherit_id" ref="base.view_users_form"/>
            <field name="arch" type="xml">

                <field name="active" position="after">
                  <button name="sync_settings" string="Sync settings" class="oe_highlight" type="object"/>               
                </field>

                <data>
                    <page string="Preferences" position="after">
                    <page string="E-mail settings">
            
                        <group colspan="4" col="4">
                            <field name="postfix_active" col="2" colspan="4"/><newline/>
                           
                            <group attrs="{'invisible': [('postfix_active','=',False)]}" colspan="4" col="4" >

                                <separator string="Vacation" colspan="4" />
                                        <field name="vacation_active"/><newline/>
                                            <field name="vacation_from"  col="2"       attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}"  />
                                            <field name="vacation_to"  col="2"         attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}"  />
                                            <field name="vacation_subject" placeholder="I am at vacation" colspan="4" attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}" />
                                            <field name="vacation_text" nolabel="1" colspan="4" 
                                                                                       attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}"  />
                                            <field name="vacation_forward" placeholder="my@vacationmail.com" col="2" colspan="4" 
                                                                                       attrs="{'invisible': [('vacation_active', '=', False)], 'required':[('vacation_active', '=', True)]}" />


                                <separator string="Forward" colspan="4" />                            
                                    <field name="forward_active" /><newline/>
                                        <field name="forward_address" nolabel="1" placeholder="my@temporarymail.comXanother@mailaddress.com" colspan="4" attrs="{'invisible': [('forward_active', '=', False)], 'required':[('forward_active', '=', True)]}" />
                                        <field name="forward_cp"      col="2" colspan="4"     attrs="{'invisible': [('forward_active', '=', False)]}" />
                                                                                        
                                 
                                <separator string="Virus check" colspan="4"/>
                                    <field name="virus_active" colspan="4" />
                                <separator string="Spam check" colspan="4" />
                                    <field name="spam_active"   /><newline/>
                                    <field name="spam_tag"      colspan="4" attrs="{'invisible': [('spam_active', '=', False),], 'required':[('spam_active', '=', True)]}" />
                                    <field name="spam_tag2"     colspan="4" attrs="{'invisible': [('spam_active', '=', False),], 'required':[('spam_active', '=', True)]}" />
                                    <field name="spam_killevel" colspan="4" attrs="{'invisible': [('spam_active', '=', False),], 'required':[('spam_active', '=', True)]}" />

                                <separator string="Misc" colspan="4" />                        
                                    <field name="maildir"   /><newline/>
                                    <field name="transport" /><newline/>
                                    <field name="quota" /><newline/>
                                    <field name="domain" /><newline/>
                                       <field name="passwd_mail" /><newline/>

                                    <separator string="Alias" /><newline/>
                                        <field name="mail_alias" nolabel="1" widget="one2many_list" colspan="4" >
                                            <tree editable="bottom" string="Mail alias">
                                              <field name="mail"/>
                                              <field name="active"/>  
                                            </tree>  
                                        </field>
                            </group>
                        </group>                
                    </page>
                </page>
                </data>
            </field>
        </record>


        


        <record id="intdomain_company" model="ir.ui.view">
            <field name="name">res.company.intdomain.config</field>
            <field name="model">res.company</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="base.view_company_form"/>
            <field name="arch" type="xml">
                <data>
                <page string="Configuration" position="inside">
                    <separator string="Internet Domain" colspan="4"/>
                    <field name="domain" string="Domain"/>
                    <newline/>
                    <button name="sync_settings" string="Sync settings" class="oe_highlight" type="object"/>    
                </page>
                </data>
                
            </field>
        </record>

<!--
        <record id="view_users_form" model="ir.ui.view">
            <field name="name">user.mail.form.inherit2</field>
            <field name="model">res.users</field>
            <field name="inherit_id" ref="base.view_users_form"/>
            <field name="arch" type="xml">
                <data>
                    <field name="active" position="after">
                            <separator string="Internet Domain" colspan="4"/>
                    </field>            
                </data>
            </field>
        </record>
-->
        
        


        <!-- Update user form !-->
<!--
        <record id="view_users_form_mail" model="ir.ui.view">
            <field name="name">res.users.form.mail.inherit</field>
            <field name="model">res.users</field>
            <field name="inherit_id" ref="base.view_users_form"/>
            <field name="arch" type="xml">
                <data>
                    <field name="signature" position="before">
                        <field name="vacation_active" />
                    </field>
                </data>
            </field>
        </record>
-->
        
        <report
            id="user_mail.mail_config"
            model="res.users"
            string="Mail configuration instructions"
            report_type="qweb-pdf"
            name="user_mail.mail_config_report"
            file="user_mail.mail_config_report"
            attachment_use="False"
            attachment="('Mailconf_'+(object.name or ''))+'.pdf'"
        />
           
       <template id="mail_config_report">
            <t t-call="report.html_container">
                <t t-foreach="doc_ids" t-as="doc_id">
                    <t t-raw="translate_doc(doc_id, doc_model, 'partner_id.lang', 'user_mail.mail_config_document')"/>
                </t>
            </t>
        </template> 

        <template id="mail_config_document">
            <t t-call="report.external_layout">
                <div class="page">
                    <div class="oe_structure"/>
                    <div class="row">
                        <div class="col-xs-6">
                       <section class="para_large">
          <div class="container">
            <div class="row">
              <div class="col-md-12 mb16 mt16">

                <h1>Mail Configuration instruction</h1>
                <p>This is the mail configuration for mail clients in mobile phones, tablets and computers.</p>

<br/>

                <table class="table table-bordered table-responsive">
                  <tbody>
                    <tr>
                      <td/>
                      <td>
                        <strong>​Server Name</strong>
                      </td>
                      <td>
                        <strong>​Port</strong>
                      </td>
                      <td>
                        <strong>​SSL/TSL</strong>
                      </td>
                      <td>
                        <strong>​Authentication</strong>
                      </td>
                    </tr>
                    <tr>
                      <td>​Incomming (IMAP)</td>
                      <td t-raw="'imap.' + (o.company_id.domain or 'example.com')"/>
                      <td>​143</td>
                      <td>​STARTTLS</td>
                      <td>​Lösenord</td>
                    </tr>
                    <tr>
                      <td>Outgoing​ (SMTP)</td>
                      <td t-raw="'smtp.' + (o.company_id.domain or 'example.com')"/>
                      <td>​587</td>
                      <td>STARTTLS​</td>
                      <td>​Lösenord</td>
                    </tr>
                    <tr>
                      <td>​Username</td>
                      <td t-raw="o.login" colspan="4"/>
                    </tr>
                    <tr>
                      <td>Password</td>
                      <td t-raw="o.passwd_mail" colspan="4"/>
                    </tr>

                  </tbody>
                </table>

<H1>Webmail</H1>
                <p>This is your credentials for webmail.</p>

                <table class="table table-bordered table-responsive">
                  <tbody>
                    <tr>
                      <td>
                        URL
                      </td>
                         <td t-raw="'http://epost.' + (o.company_id.domain or 'example.com')"/>

                    </tr>

                    <tr>
                      <td>​Username</td>
                      <td colspan="4" t-raw="o.login"/>
                    </tr>
                    <tr>
                      <td>Password</td>
                      <td colspan="4" t-raw="o.passwd_mail" />
                    </tr>
                  </tbody>
                </table>

               
              </div>
            </div>
          </div>
        </section>

                        </div>
                    </div>
                    <div class="oe_structure"/>
                </div>
            </t>
        </template>

        

        
    </data> 
</openerp>
    
